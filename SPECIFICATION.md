# Game Creator MVP - 仕様書

## プロジェクト概要

ブラウザゲーム作成プラットフォームのMVP（Minimum Viable Product）。
ユーザーがチャット形式で指示を送ると、サーバーサイドで Claude Code CLI が自動的にゲームコードを生成・更新します。

### 主な特徴
- チャットベースのゲーム作成インターフェース
- リアルタイムプレビュー
- AI による Skills 自動選択（ユーザーは意識不要）
- Git ベースのバージョン管理
- 複数プロジェクト管理

---

## システム構成図

```
┌─────────────────────────────────────────────────────────────────┐
│  クライアント（ブラウザ）                                         │
│  ┌─────────────────────┐  ┌─────────────────────────────────┐   │
│  │    チャット UI       │  │      ゲームプレビュー (iframe)    │   │
│  │  - メッセージ入力    │  │      /game/{userId}/{projectId}  │   │
│  │  - 履歴表示         │  │                                  │   │
│  │  - ストリーミング表示 │  │                                  │   │
│  └─────────────────────┘  └─────────────────────────────────┘   │
│            │ WebSocket                    │ HTTP                │
└────────────┼──────────────────────────────┼─────────────────────┘
             │                              │
             ▼                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  サーバー (Node.js + Express)              Port: 3000            │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  index.js                                                   ││
│  │  - WebSocket サーバー                                        ││
│  │  - 静的ファイル配信                                          ││
│  │  - ゲームファイル配信 (/game/:visitorId/:projectId/*)        ││
│  └─────────────────────────────────────────────────────────────┘│
│            │                              │                     │
│            ▼                              ▼                     │
│  ┌─────────────────────┐    ┌─────────────────────────────────┐│
│  │   claudeRunner.js   │    │       userManager.js            ││
│  │  - Claude CLI 実行   │    │  - ユーザー管理                  ││
│  │  - Skills 自動選択   │    │  - プロジェクト管理               ││
│  │  - ストリーミング処理 │    │  - Git バージョン管理            ││
│  └──────────┬──────────┘    └─────────────────────────────────┘│
│             │                                                   │
│             ▼                                                   │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  Claude Code CLI (spawn)                                    ││
│  │  --print --verbose --output-format stream-json              ││
│  │  --dangerously-skip-permissions                             ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
             │
             ▼
┌─────────────────────────────────────────────────────────────────┐
│  ファイルシステム                                                │
│  users/                                                         │
│  ├── .git/                    ← 全ユーザー活動ログ               │
│  └── {visitorId}/                                               │
│      ├── projects.json        ← プロジェクト一覧                 │
│      └── {projectId}/                                           │
│          ├── .git/            ← プロジェクト版バージョン管理      │
│          ├── index.html       ← ゲームコード                     │
│          └── chat-history.json← 会話履歴                        │
└─────────────────────────────────────────────────────────────────┘
```

---

## ファイル構成

```
GameCreatorMVP-v2/
├── package.json              # プロジェクト設定・依存関係
├── SPECIFICATION.md          # 本仕様書
├── .gitignore                # Git 除外設定
│
├── server/                   # バックエンド
│   ├── index.js              # メインサーバー（Express + WebSocket）
│   ├── claudeRunner.js       # Claude Code CLI 実行・Skills 管理
│   └── userManager.js        # ユーザー・プロジェクト・Git 管理
│
├── public/                   # フロントエンド
│   ├── index.html            # メイン HTML
│   ├── style.css             # スタイルシート
│   └── app.js                # クライアント JavaScript
│
├── .claude/                  # Claude Code 設定
│   └── skills/               # Skills ライブラリ
│       ├── p5js/             # P5.js（2Dゲーム）
│       ├── threejs/          # Three.js（3Dゲーム）
│       ├── game-audio/       # Howler.js（音声）
│       ├── game-ai/          # Yuka.js（AI）
│       ├── particles/        # tsParticles（パーティクル）
│       └── tween-animation/  # GSAP（アニメーション）
│
└── users/                    # ユーザーデータ（Git 管理外）
    ├── .git/                 # 全ユーザー活動ログ
    └── {visitorId}/
        ├── projects.json
        └── {projectId}/
            ├── .git/
            ├── index.html
            └── chat-history.json
```

### 各ファイルの役割

| ファイル | 役割 |
|---------|------|
| `server/index.js` | Express サーバー、WebSocket 通信、ルーティング |
| `server/claudeRunner.js` | Claude Code CLI の実行、Skills 自動検出・適用 |
| `server/userManager.js` | ユーザー・プロジェクト CRUD、Git 操作、セッション管理 |
| `public/index.html` | チャット UI とプレビューのレイアウト |
| `public/style.css` | ダークテーマ UI スタイル |
| `public/app.js` | WebSocket クライアント、UI ロジック |

---

## 使用技術

### バックエンド
| 技術 | バージョン | 用途 |
|-----|-----------|------|
| Node.js | 22.x | ランタイム |
| Express | 4.18.x | HTTP サーバー |
| ws | 8.14.x | WebSocket サーバー |
| uuid | 9.x | ユニーク ID 生成 |
| Claude Code CLI | latest | コード生成エンジン |
| Git | - | バージョン管理 |

### フロントエンド
| 技術 | 用途 |
|-----|------|
| Vanilla JavaScript | クライアントロジック |
| WebSocket API | リアルタイム通信 |
| CSS3 | ダークテーマ UI |

### Skills（ゲームライブラリ）
| ライブラリ | CDN バージョン | 用途 |
|-----------|---------------|------|
| P5.js | 1.11.0 | 2D ゲーム・クリエイティブコーディング |
| Three.js | 0.170.0 | 3D ゲーム・ビジュアライゼーション |
| Howler.js | 2.2.4 | BGM・効果音・3D サウンド |
| Yuka.js | 0.7.8 | 敵 AI・パスファインディング |
| tsParticles | 2.12.0 | パーティクルエフェクト |
| GSAP | 3.12.5 | UI アニメーション |

---

## 機能一覧

### ユーザー機能
| 機能 | 説明 |
|-----|------|
| 自動ユーザー作成 | 初回アクセス時に UUID で自動生成 |
| プロジェクト作成 | 複数のゲームプロジェクトを管理 |
| プロジェクト削除 | 不要なプロジェクトを削除 |
| プロジェクト名変更 | プロジェクト名をカスタマイズ |

### ゲーム作成機能
| 機能 | 説明 |
|-----|------|
| チャット入力 | 自然言語でゲームの指示を送信 |
| Skills 自動選択 | キーワードから最適なライブラリを自動選択 |
| リアルタイムプレビュー | 生成されたゲームを iframe で即時表示 |
| ストリーミング表示 | コード生成過程をリアルタイム表示 |
| 日本語 IME 対応 | 変換確定前の Enter で送信されない |

### バージョン管理機能
| 機能 | 説明 |
|-----|------|
| 自動コミット | コード更新時に Git で自動保存 |
| バージョン履歴 | 過去のバージョン一覧表示 |
| バージョン復元 | 任意のバージョンに戻す |
| 活動ログ | users/ 全体の操作履歴（学習データ用）|

### 通信機能
| 機能 | 説明 |
|-----|------|
| WebSocket | リアルタイム双方向通信 |
| 自動再接続 | 切断時に 3 秒後自動再接続 |
| 処理キャンセル | 停止ボタンで生成を中断 |

---

## Skills 一覧と役割

### 自動選択の仕組み

ユーザーのメッセージと会話履歴からキーワードを検出し、最適な Skills を最大 2 つ選択。

```javascript
// キーワード例
'p5js': ['2d', 'シューティング', 'ブロック崩し', 'canvas', '当たり判定']
'threejs': ['3d', '立体', 'キューブ', '物理', 'レーシング']
'game-audio': ['音', 'bgm', '効果音', 'サウンド']
'game-ai': ['ai', '敵', 'npc', '追いかけ', 'パスファインディング']
'particles': ['パーティクル', '爆発', '紙吹雪', '花火', '雪']
'tween-animation': ['アニメーション', 'フェード', 'イージング']
```

### 各 Skill の詳細

| Skill | ライブラリ | 主な用途 |
|-------|-----------|---------|
| p5js | P5.js | 2D ゲーム、クリエイティブコーディング、シューティング、パズル |
| threejs | Three.js + cannon-es | 3D ゲーム、物理シミュレーション、FPS、レーシング |
| game-audio | Howler.js | BGM ループ、効果音、3D ポジショナルオーディオ |
| game-ai | Yuka.js | 敵 AI 行動、パスファインディング、ステートマシン |
| particles | tsParticles | 爆発、紙吹雪、花火、雪、火花エフェクト |
| tween-animation | GSAP | スコア演出、UI フェード、スムーズアニメーション |

---

## 起動方法

### 前提条件
- Node.js 18.x 以上
- Claude Code CLI がインストール・認証済み

### 手順

```bash
# 1. リポジトリをクローン
git clone https://github.com/notef-neighbor/GameCreatorMVP.git
cd GameCreatorMVP

# 2. 依存関係をインストール
npm install

# 3. サーバーを起動
npm start

# 4. ブラウザでアクセス
open http://localhost:3000
```

### 外部公開（テスト用）

```bash
# ngrok でトンネル作成
ngrok http 3000
```

---

## 環境変数

| 変数名 | デフォルト | 説明 |
|-------|-----------|------|
| `PORT` | `3000` | サーバーのリッスンポート |

### 設定例（.env）

```env
PORT=3000
```

※ 現在は `.env` ファイルは使用していませんが、将来の拡張用に予約。

---

## 制限事項・既知の問題

### 現在の制限
- 同一プロジェクトの同時編集は非対応
- 認証機能なし（visitorId による簡易識別のみ）
- ファイルは `index.html` 単一ファイルのみ

### 本番環境向け改善候補
- プロジェクト単位のロック機構
- ユーザー認証（OAuth など）
- 複数ファイル対応
- データベース導入（現在はファイルシステム）

---

## ライセンス

MIT License

---

## 更新履歴

| 日付 | 内容 |
|-----|------|
| 2026-01-08 | 初版作成 |
